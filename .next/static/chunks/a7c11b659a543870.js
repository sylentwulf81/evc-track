(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},32545,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(20755),s=e.i(67881),l=e.i(23750),c=e.i(10708),n=e.i(62870),i=e.i(70065),d=e.i(75254);let o=(0,d.default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),h=(0,d.default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),m=(0,d.default)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);var u=e.i(39312);let x=(0,d.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),p=(0,d.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var g=e.i(22016),j=e.i(95187),y=(0,j.createServerReference)("4024f26f6e4f2e8f45b2e2692fc8e65b112e5c32cb",j.callServer,void 0,j.findSourceMapURL,"updateProfile"),v=e.i(49967),f=(0,j.createServerReference)("00fa75ca9b62b0091512d0f293da094299feb7af98",j.callServer,void 0,j.findSourceMapURL,"getChargingSessions"),b=e.i(56563),S=e.i(46696),C=e.i(85728);let N="evc_battery_capacity",k="evc_home_rate";function w(){let{t:e,language:d,setLanguage:j}=(0,C.useLanguage)(),[w,D]=(0,a.useState)(null),[I,P]=(0,a.useState)(!0),[R,_]=(0,a.useState)(!1),[L,M]=(0,a.useState)(""),[T,U]=(0,a.useState)(""),[B,H]=(0,a.useState)("JPY"),E=(0,r.createClient)();(0,a.useEffect)(()=>{(async()=>{let{data:{user:e}}=await E.auth.getUser();if(D(e),e){let e=await (0,v.getProfile)();e&&(M(e.battery_capacity?.toString()??""),U(e.home_rate?.toString()??""),H(e.currency||"JPY"))}else{let e=localStorage.getItem(N),t=localStorage.getItem(k),a=(0,b.getLocalCurrency)();e&&M(e),t&&U(t),a&&H(a)}P(!1)})()},[E]);let O=async t=>{t.preventDefault(),_(!0);try{if(w){let t=new FormData;t.append("batteryCapacity",L),t.append("homeRate",T),t.append("currency",B);let a=await y(t);if(a.error)throw Error(a.error);S.toast.success(e("common.success"))}else localStorage.setItem(N,L),localStorage.setItem(k,T),(0,b.setLocalCurrency)(B),S.toast.success(e("common.success"))}catch(t){S.toast.error(t.message||e("common.error"))}finally{_(!1)}},A=async()=>{try{let t=[];if(!(t=w?await f():(0,b.getLocalSessions)())||0===t.length)return void S.toast.error(e("history.noData"));let a=["Date",`${e("common.cost")} (${B})`,e("forms.startPercent"),e("forms.endPercent"),"kWh",e("forms.type")],r=t.map(e=>[new Date(e.charged_at).toLocaleString(),e.cost,e.start_percent,e.end_percent,e.kwh||"",e.charge_type||"standard"]),s=[a.join(","),...r.map(e=>e.join(","))].join("\n"),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(l),n=document.createElement("a");n.setAttribute("href",c),n.setAttribute("download",`ev_charging_data_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(t){console.error(t),S.toast.error(e("common.error"))}};return I?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsx)(u.Zap,{className:"h-8 w-8 animate-pulse text-primary"})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5 p-4 pb-24",children:(0,t.jsxs)("div",{className:"container max-w-lg mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(g.default,{href:"/",children:(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"rounded-full",children:(0,t.jsx)(o,{className:"h-5 w-5"})})}),(0,t.jsx)("h1",{className:"text-xl font-bold",children:e("settings.title")})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"p-2 bg-primary/10 rounded-full",children:(0,t.jsx)(p,{className:"h-5 w-5 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{children:e("common.language")}),(0,t.jsx)(i.CardDescription,{children:"Select your preferred language"})]})]})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsxs)(n.Select,{value:d,onValueChange:e=>j(e),children:[(0,t.jsx)(n.SelectTrigger,{id:"language",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select language"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"en",children:"English"}),(0,t.jsx)(n.SelectItem,{value:"es",children:"Español"}),(0,t.jsx)(n.SelectItem,{value:"ja",children:"日本語"})]})]})})})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"p-2 bg-primary/10 rounded-full",children:(0,t.jsx)(m,{className:"h-5 w-5 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{children:e("settings.vehicleProfile")}),(0,t.jsx)(i.CardDescription,{children:e("settings.vehicleProfileDesc")})]})]})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"currency",children:e("common.currency")}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)(n.Select,{value:B,onValueChange:H,children:[(0,t.jsx)(n.SelectTrigger,{id:"currency",children:(0,t.jsx)(n.SelectValue,{placeholder:"Select currency"})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"JPY",children:"JPY (¥)"}),(0,t.jsx)(n.SelectItem,{value:"USD",children:"USD ($)"}),(0,t.jsx)(n.SelectItem,{value:"EUR",children:"EUR (€)"}),(0,t.jsx)(n.SelectItem,{value:"GBP",children:"GBP (£)"})]})]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c.Label,{htmlFor:"batteryCapacity",children:[e("settings.batteryCapacity")," (kWh)"]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Input,{id:"batteryCapacity",type:"number",step:"0.1",placeholder:"e.g. 75.0",value:L,onChange:e=>M(e.target.value)}),(0,t.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:"kWh"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e("settings.batteryCapacityDesc")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"homeRate",children:e("settings.homeRate")}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Input,{id:"homeRate",type:"number",step:"0.01",placeholder:"e.g. 30.00",value:T,onChange:e=>U(e.target.value)}),(0,t.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:"/kWh"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e("settings.homeRateDesc")})]}),(0,t.jsx)(s.Button,{type:"submit",className:"w-full",disabled:R,children:R?e("common.loading"):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h,{className:"mr-2 h-4 w-4"})," ",e("common.save")]})})]})})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"p-2 bg-primary/10 rounded-full",children:(0,t.jsx)(x,{className:"h-5 w-5 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{children:e("settings.dataManagement")}),(0,t.jsx)(i.CardDescription,{children:e("settings.exportData")})]})]})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsxs)(s.Button,{variant:"outline",className:"w-full",onClick:A,children:[(0,t.jsx)(x,{className:"mr-2 h-4 w-4"})," ",e("settings.exportData")]})})]}),!w&&(0,t.jsxs)("div",{className:"text-center p-4 rounded-lg bg-muted/50 text-sm text-muted-foreground",children:[(0,t.jsx)("p",{children:e("settings.signInToSync")}),(0,t.jsx)(g.default,{href:"/auth/login",className:"text-primary hover:underline mt-2 inline-block",children:"Sign In"})]})]})})}e.s(["default",()=>w],32545)}]);